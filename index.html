<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="/manifest.json" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Site Monitoring Chart</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #f0f4f8, #dbeafe);
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h2, h3 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 20px;
      color: #1e3a8a;
    }

    .location-date {
      text-align: center;
      margin-bottom: 30px;
    }

    .location, .date-time {
      margin-bottom: 10px;
    }

    input[type="text"], input[type="date"], input[type="time"] {
      font-size: 1.1rem;
      text-align: center;
      border: 1px solid #94a3b8;
      border-radius: 10px;
      padding: 10px;
      width: 250px;
      font-weight: bold;
      background-color: #fff;
      color: #1e293b;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
      transition: box-shadow 0.3s ease;
    }

    input:focus {
      outline: none;
      box-shadow: 0 0 5px #60a5fa;
    }

    .chart-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
      padding: 20px;
      text-align: center;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card img {
      height: 60px;
      margin-bottom: 8px;
    }

    .card label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #1e40af;
    }

    .card input {
      width: 100%;
      box-sizing: border-box;
    }

    .heat-index-levels {
      margin-top: 30px;
      background-color: #ffffff;
      border-radius: 12px;
      padding: 20px;
    }

    .heat-index-levels table {
      width: 60%;
      margin: 0 auto;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    .heat-index-levels th, .heat-index-levels td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ccc;
    }

    .safe { background-color: #bbf7d0; color: #166534; }
    .caution { background-color: #fef08a; color: #92400e; }
    .extreme-caution { background-color: #fdba74; color: #7c2d12; }
    .danger { background-color: #f87171; color: #ffffff; }
    .extreme-danger { background-color: #7f1d1d; color: #ffffff; }
  </style>
</head>
<body>
  <div class="location-date">
    <div class="location">
      <label>Site Location:</label><br>
      <input type="text" id="site-location" placeholder="Enter site location" required />
    </div>
    <div class="date-time">
      <label>Date:</label><br>
      <input type="date" id="datetime" required />
    </div>
    <div class="date-time">
      <label>Time:</label><br>
      <input type="time" id="time" required />
    </div>
  </div>

  <h2>Site Monitoring Chart</h2>

  <div class="chart-container">
    <div class="card">
      <img src="relative_humidity_logo.png" alt="Relative Humidity" />
      <label>Relative Humidity (%)</label>
      <input type="text" id="humidity" onblur="formatWithUnit(this, '%'); calculateHeatIndex();" required />
    </div>
    <div class="card">
      <img src="weather_temperature_logo.png" alt="Temperature" />
      <label>Temperature (Â°C)</label>
      <input type="text" id="temperature" onblur="formatWithUnit(this, 'Â°C'); calculateHeatIndex();" required />
    </div>
    <div class="card">
      <img src="illumination_logo.png" alt="Illumination" />
      <label>Illumination (lux)</label>
      <input type="text" id="illumination" onblur="formatWithUnit(this, 'lux')" required />
    </div>
    <div class="card">
      <img src="wind_speed_logo.png" alt="Wind Speed" />
      <label>Wind Speed (km/h)</label>
      <input type="text" id="wind-speed" onblur="formatWithUnit(this, 'km/h')" required />
    </div>
    <div class="card">
      <img src="noise_logo.png" alt="Noise Level" />
      <label>Noise Level (dB)</label>
      <input type="text" id="noise" onblur="formatWithUnit(this, 'dB')" required />
    </div>
    <div class="card">
      <img src="heat_index_logo.png" alt="Heat Index" />
      <label>Heat Index (Â°C)</label>
      <input type="text" id="heat-index" readonly />
    </div>
  </div>

  <div class="heat-index-levels">
    <h3>Heat Index Danger Levels</h3>
    <table>
      <tr><th>Heat Index Range (Â°C)</th><th>Danger Level</th></tr>
      <tr><td>Less than 27Â°C</td><td class="safe">Safe</td></tr>
      <tr><td>27Â°C to 32Â°C</td><td class="caution">Caution</td></tr>
      <tr><td>33Â°C to 41Â°C</td><td class="extreme-caution">Extreme Caution</td></tr>
      <tr><td>42Â°C to 51Â°C</td><td class="danger">Danger</td></tr>
      <tr><td>Greater than 52Â°C</td><td class="extreme-danger">Extreme Danger</td></tr>
    </table>
  </div>

  <div style="text-align: center; margin-top: 20px;">
    <button onclick="saveEntry()">ðŸ’¾ Save Entry</button>
    <button onclick="clearAll()">ðŸ§¹ Clear All</button>
    <button onclick="viewEntries()">ðŸ“‚ View Saved Entries</button>
  </div>

  <div id="saved-entries" style="margin-top: 30px; display: none;">
    <h3>ðŸ“‹ Saved Entries</h3>
    <div style="text-align: center;">
      <input type="text" id="search-location" placeholder="Search by location..." oninput="searchEntries()" />
      <input type="date" id="search-date" placeholder="Search by date..." oninput="searchEntries()" />
    </div>
    <div id="entries-list" style="white-space: pre-line; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-height: 300px; overflow-y: auto;"></div>
  </div>

  <script>
    function formatWithUnit(input, unit) {
      let value = input.value.trim();
      if (value === '-' || isNaN(value)) {
        input.value = value; // If it's a hyphen or non-number, no unit will be added
      } else {
        value = value.replace(new RegExp(`\\s*${unit}$`), '');
        if (value !== '') {
          input.value = value + ' ' + unit;
        }
      }
    }

    function parseValue(inputId, unit) {
      let val = document.getElementById(inputId).value.trim();
      return parseFloat(val.replace(unit, '').trim());
    }

    function calculateHeatIndex() {
      const tempC = parseValue('temperature', 'Â°C');
      const humidity = parseValue('humidity', '%');
      if (isNaN(tempC) || isNaN(humidity)) return;

      const T = (tempC * 1.8) + 32;
      const H = humidity;

      const HI_F = (
        -42.379 + 2.04901523 * T + 10.14333127 * H
        - 0.22475541 * T * H - 0.00683783 * T * T
        - 0.05481717 * H * H + 0.00122874 * T * T * H
        + 0.00085282 * T * H * H - 0.00000199 * T * T * H * H
      );

      const HI_C = (HI_F - 32) / 1.8;
      document.getElementById('heat-index').value = HI_C.toFixed(1) + ' Â°C';
    }

    function saveEntry() {
      const entry = {
        location: document.getElementById('site-location').value,
        date: document.getElementById('datetime').value,
        time: document.getElementById('time').value,
        humidity: document.getElementById('humidity').value,
        temperature: document.getElementById('temperature').value,
        illumination: document.getElementById('illumination').value,
        windSpeed: document.getElementById('wind-speed').value,
        noise: document.getElementById('noise').value,
        heatIndex: document.getElementById('heat-index').value,
        timestamp: new Date().toLocaleString()
      };

      const allEntries = JSON.parse(localStorage.getItem('siteEntries') || '[]');
      allEntries.push(entry);
      localStorage.setItem('siteEntries', JSON.stringify(allEntries));
      alert('âœ… Entry saved successfully!');
    }

    function clearAll() {
      document.getElementById('site-location').value = '';
      document.getElementById('datetime').value = '';
      document.getElementById('time').value = '';
      document.getElementById('humidity').value = '';
      document.getElementById('temperature').value = '';
      document.getElementById('illumination').value = '';
      document.getElementById('wind-speed').value = '';
      document.getElementById('noise').value = '';
      document.getElementById('heat-index').value = '';
    }

    function viewEntries() {
      const container = document.getElementById('saved-entries');
      const list = document.getElementById('entries-list');
      const entries = JSON.parse(localStorage.getItem('siteEntries') || '[]');

      if (entries.length === 0) {
        list.innerText = "No saved entries.";
      } else {
        list.innerHTML = entries.map((e, i) =>
          `<div class="entry-row">
            #${i + 1} [${e.timestamp}]<br />
            Location: ${e.location} | Date: ${e.date} | Time: ${e.time}<br />
            Humidity: ${e.humidity} | Temp: ${e.temperature} | Illumination: ${e.illumination} | Wind: ${e.windSpeed} | Noise: ${e.noise} | Heat Index: ${e.heatIndex}<br />
          </div>`
        ).join('');
      }

      container.style.display = 'block';
    }

    function searchEntries() {
      const locationQuery = document.getElementById('search-location').value.toLowerCase();
      const dateQuery = document.getElementById('search-date').value;
      const entries = JSON.parse(localStorage.getItem('siteEntries') || '[]');
      
      const filteredEntries = entries.filter(e => {
        const locationMatch = e.location.toLowerCase().includes(locationQuery);
        const dateMatch = dateQuery ? e.date === dateQuery : true;
        return locationMatch && dateMatch;
      });

      const list = document.getElementById('entries-list');

      if (filteredEntries.length === 0) {
        list.innerText = "No matching entries.";
      } else {
        list.innerHTML = filteredEntries.map((e, i) =>
          `<div class="entry-row">
            #${i + 1} [${e.timestamp}]<br />
            Location: ${e.location} | Date: ${e.date} | Time: ${e.time}<br />
            Humidity: ${e.humidity} | Temp: ${e.temperature} | Illumination: ${e.illumination} | Wind: ${e.windSpeed} | Noise: ${e.noise} | Heat Index: ${e.heatIndex}<br />
          </div>`
        ).join('');
      }
    }
  </script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .then((registration) => {
        console.log('Service Worker registered with scope:', registration.scope);
      })
      .catch((error) => {
        console.log('Service Worker registration failed:', error);
      });
  }
</script>
</body>
</html>
